[supervisord]
nodaemon=true
user=app
pidfile=/tmp/supervisord.pid
logfile=/app/logs/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
loglevel=info

[program:flask]
command=gunicorn --bind 0.0.0.0:8000 --workers 4 --worker-class gevent --worker-connections 1000 --timeout 120 --keepalive 5 --max-requests 1000 --max-requests-jitter 100 --preload manage:app
directory=/app
user=app
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/flask.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
environment=FLASK_ENV=production,PYTHONPATH=/app

[program:celery]
command=celery -A app.celery worker --loglevel=info --concurrency=2 --max-tasks-per-child=1000
directory=/app
user=app
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/celery.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
environment=FLASK_ENV=production,PYTHONPATH=/app

[program:celery-beat]
command=celery -A app.celery beat --loglevel=info --schedule=/tmp/celerybeat-schedule
directory=/app
user=app
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/celery-beat.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
environment=FLASK_ENV=production,PYTHONPATH=/app

[group:portfolio]
programs=flask,celery,celery-beat
priority=999