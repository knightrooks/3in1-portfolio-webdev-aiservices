{% extends "base.html" %}

{% block title %}{{ agent.name }} - AI Agent{% endblock %}

{% block meta_description %}Interact with {{ agent.name }}, {{ agent.description }}{% endblock %}

{% block extra_css %}
<style>
    .chat-container {
        height: 500px;
        border: 1px solid #dee2e6;
        border-radius: 10px;
        overflow-y: auto;
        background-color: #f8f9fa;
        padding: 20px;
    }
    .message {
        margin-bottom: 15px;
        padding: 10px 15px;
        border-radius: 18px;
        max-width: 80%;
    }
    .user-message {
        background: linear-gradient(135deg, #007bff, #0056b3);
        color: white;
        margin-left: auto;
        text-align: right;
    }
    .agent-message {
        background: linear-gradient(135deg, #28a745, #1e7e34);
        color: white;
        margin-right: auto;
    }
    .agent-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
    }
    .capability-badge {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
    }
    .stats-widget {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
    }
    .typing-indicator {
        display: none;
        padding: 10px 15px;
        background: #e9ecef;
        border-radius: 18px;
        margin-bottom: 15px;
        max-width: 80px;
    }
    .typing-dots {
        display: flex;
        align-items: center;
        gap: 3px;
    }
    .typing-dots span {
        height: 8px;
        width: 8px;
        background: #6c757d;
        border-radius: 50%;
        animation: typing 1.4s infinite ease-in-out;
    }
    .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
    .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

    @keyframes typing {
        0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
        40% { transform: scale(1); opacity: 1; }
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5 pt-4">
    <!-- Agent Header -->
    <div class="agent-header text-center">
        <div class="row align-items-center">
            <div class="col-md-2">
                <div style="font-size: 4rem; color: {{ agent.color }}">{{ agent.icon }}</div>
            </div>
            <div class="col-md-8">
                <h1 class="display-4 mb-2">{{ agent.name }}</h1>
                <p class="lead mb-3">{{ agent.description }}</p>
                <div class="mb-3">
                    <span class="badge capability-badge me-2">{{ agent.category|title }}</span>
                    {% for capability in agent.capabilities[:4] %}
                    <span class="badge capability-badge me-1">{{ capability.replace('_', ' ')|title }}</span>
                    {% endfor %}
                </div>
            </div>
            <div class="col-md-2">
                <div class="stats-widget bg-white text-dark">
                    <h4 class="mb-1">24/7</h4>
                    <small>Available</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Chat Interface -->
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-comments"></i>
                            Chat with {{ agent.name }}
                        </h5>
                        <span class="badge bg-success">
                            <i class="fas fa-circle"></i> Online
                        </span>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="chat-container" id="chatContainer">
                        <div class="message agent-message">
                            <strong>{{ agent.name }}:</strong><br>
                            Hello! I'm {{ agent.name }}, and I'm here to help you with {{ agent.capabilities[0].replace('_', ' ') }}. 
                            What would you like to know or discuss today?
                        </div>
                    </div>
                    <div class="typing-indicator" id="typingIndicator">
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <form id="chatForm" class="d-flex">
                        <input type="text" class="form-control me-2" id="messageInput" 
                               placeholder="Type your message..." autocomplete="off">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Agent Information Sidebar -->
        <div class="col-lg-4">
            <!-- Agent Stats -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-bar"></i> Agent Statistics
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="stats-widget mb-3">
                                <h4 class="text-success">98.5%</h4>
                                <small>Success Rate</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stats-widget mb-3">
                                <h4 class="text-info">1.2s</h4>
                                <small>Avg Response</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stats-widget">
                                <h4 class="text-warning">2.4k</h4>
                                <small>Conversations</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stats-widget">
                                <h4 class="text-danger">â˜… 4.8</h4>
                                <small>Rating</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Capabilities -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-cogs"></i> Capabilities
                    </h5>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        {% for capability in agent.capabilities %}
                        <li class="mb-2">
                            <i class="fas fa-check-circle text-success"></i>
                            {{ capability.replace('_', ' ')|title }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-bolt"></i> Quick Actions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="sendQuickMessage('Help me get started')">
                            <i class="fas fa-play"></i> Get Started
                        </button>
                        <button class="btn btn-outline-info btn-sm" onclick="sendQuickMessage('What are your capabilities?')">
                            <i class="fas fa-info-circle"></i> Learn More
                        </button>
                        <button class="btn btn-outline-success btn-sm" onclick="sendQuickMessage('Show me an example')">
                            <i class="fas fa-lightbulb"></i> Show Example
                        </button>
                        <a href="/agents/api/{{ agent_id }}/analytics" class="btn btn-outline-warning btn-sm">
                            <i class="fas fa-chart-line"></i> View Analytics
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="row mt-4">
        <div class="col-12 text-center">
            <a href="{{ url_for('agents.dashboard') }}" class="btn btn-secondary me-2">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
            <a href="{{ url_for('agents.api_overview') }}" class="btn btn-info">
                <i class="fas fa-code"></i> API Documentation
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const chatForm = document.getElementById('chatForm');
    const messageInput = document.getElementById('messageInput');
    const chatContainer = document.getElementById('chatContainer');
    const typingIndicator = document.getElementById('typingIndicator');

    // Focus on input
    messageInput.focus();

    // Handle form submission
    chatForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const message = messageInput.value.trim();
        if (message) {
            sendMessage(message);
            messageInput.value = '';
        }
    });

    function sendMessage(message) {
        // Add user message
        addMessage(message, 'user');
        
        // Show typing indicator
        showTyping();
        
        // Simulate agent response (in real implementation, this would be an API call)
        setTimeout(() => {
            hideTyping();
            const responses = [
                "That's a great question! Let me help you with that.",
                "I understand what you're looking for. Here's my take on it:",
                "Interesting! Based on my experience, I'd suggest:",
                "Let me provide you with some insights on that topic:",
                "That's exactly the kind of challenge I love to tackle!"
            ];
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            addMessage(randomResponse, 'agent');
        }, 1000 + Math.random() * 2000);
    }

    function addMessage(message, sender) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${sender}-message`;
        
        if (sender === 'agent') {
            messageDiv.innerHTML = `<strong>{{ agent.name }}:</strong><br>${message}`;
        } else {
            messageDiv.innerHTML = `<strong>You:</strong><br>${message}`;
        }
        
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function showTyping() {
        typingIndicator.style.display = 'block';
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function hideTyping() {
        typingIndicator.style.display = 'none';
    }

    // Make sendQuickMessage available globally
    window.sendQuickMessage = function(message) {
        sendMessage(message);
    };
});
</script>
{% endblock %}